# PairCoder Backlog: Bugs & Improvements

> Compiled from React SDK deployment session (2025-12-18)

---

## Critical: Full Cookie Cutter Review

### REVIEW-001: Cookie cutter template files are stale
**Severity:** HIGH  
**Component:** Cookie Cutter

**Description:**  
Multiple template files in the cookie cutter are outdated. Files that existed got skipped during updates, leaving them with old content while new files were added correctly.

**Affected Files (confirmed stale):**
- `.paircoder/context/state.md` - Old format, missing session tracking
- `.paircoder/context/project.md` - Generic, not project-type specific
- `.paircoder/context/workflow.md` - Needs review
- `CODEOWNERS` - Generic placeholders
- `.github/workflows/ci.yml` - Too generic (both Node + Python)
- `.github/workflows/project_tree.yml` - Wrong output path

**Root Cause:**  
Cookie cutter init is non-destructive - it doesn't overwrite existing files. But when template files are updated in paircoder, the old versions in the template directory weren't synced.

**Fix Required:**
1. Full audit of all template files against current paircoder equivalents
2. Update all stale files to current format
3. Add CI check to detect template drift
4. Document which files are preset-specific vs universal

**Acceptance Criteria:**
- [ ] All template files audited against paircoder source
- [ ] state.md template matches current format
- [ ] project.md template is useful (or preset-specific)
- [ ] workflow.md template is current
- [ ] CI workflows are preset-appropriate
- [ ] CODEOWNERS has clear placeholders
- [ ] Add template sync check to release checklist

---

## Bugs

### BUG-001: Plan list shows incorrect task count
**Severity:** Medium  
**Component:** CLI / Planning

**Description:**  
`bpsai-pair plan list` shows "Tasks: 0" even when tasks exist for the plan.

**Observed:**
```
┃ ID                            ┃ Title              ┃ Tasks ┃
│ plan-2025-12-react-sdk-phase1 │ React SDK Phase 1  │     0 │
```

But `bpsai-pair task list` shows 14 tasks with that plan_id.

**Root Cause:**  
Plan list command doesn't query TaskParser for associated tasks. Task count likely hardcoded or not computed.

**Fix Location:**  
`tools/cli/bpsai_pair/planning/cli_commands.py` - plan list command

**Acceptance Criteria:**
- [ ] Plan list shows accurate task count
- [ ] Count derived from tasks with matching plan_id

---

### BUG-002: Task model missing `depends_on` causes hook failure
**Severity:** Medium  
**Component:** Planning / Hooks

**Description:**  
The `check_unblocked` hook fails with `'Task' object has no attribute 'depends_on'` when completing tasks.

**Error observed:**
```
✅ Updated T2.3 -> done
Unblock check failed: 'Task' object has no attribute 'depends_on'
```

**Root Cause:**  
1. Task model in `planning/models.py` may not have `depends_on` field
2. Task files generated by cookie cutter/planning don't include `depends_on: []`
3. Hook assumes field exists without checking

**Fix Options:**
1. Add `depends_on: List[str] = []` to Task model with default
2. Update hook to handle missing attribute gracefully
3. Update task template to always include `depends_on: []`

**Fix Location:**  
- `tools/cli/bpsai_pair/planning/models.py` - Task dataclass
- `tools/cli/bpsai_pair/hooks.py` - check_unblocked handler
- Cookie cutter task templates

**Acceptance Criteria:**
- [ ] Task model has `depends_on` field with default empty list
- [ ] Hook handles missing attribute gracefully
- [ ] New tasks created with `depends_on: []` by default
- [ ] Existing tasks without field don't cause errors

---

## Missing Features in Cookie Cutter

### MISSING-001: /commands directory not in template
**Severity:** Medium  
**Component:** Cookie Cutter

**Description:**  
The `.claude/commands/` directory for slash commands is not included in the cookie cutter template.

**Fix Location:**  
`tools/cli/bpsai_pair/data/cookiecutter-paircoder/{{cookiecutter.project_slug}}/.claude/`

**Acceptance Criteria:**
- [ ] `.claude/commands/` directory created in template
- [ ] Include starter slash commands (or .gitkeep)
- [ ] Document slash commands in CLAUDE.md

---

### MISSING-002: React preset missing Trello config
**Severity:** High  
**Component:** Presets

**Description:**  
The `react` preset (and likely others) doesn't include Trello configuration section in config.yaml. User had to manually add full config.

**Current preset output:**
```yaml
version: '2.4'
project: ...
workflow: ...
pack: ...
flows: ...
# NO trello, estimation, metrics, hooks, security sections
```

**Fix Location:**  
`tools/cli/bpsai_pair/presets.py`

**Acceptance Criteria:**
- [ ] All presets include Trello config section (with empty board_id)
- [ ] All presets include estimation section
- [ ] All presets include metrics section  
- [ ] All presets include hooks section (Sprint 17 hooks)
- [ ] All presets include security section
- [ ] Version bumped to 2.6

---

### MISSING-003: Preset-specific CI workflows too generic
**Severity:** Low  
**Component:** Cookie Cutter / GitHub Workflows

**Description:**  
The ci.yml workflow includes both Node and Python CI jobs. React projects don't need Python CI, and vice versa.

**Options:**
1. Make workflows preset-specific (react = Node only)
2. Remove CI from template, let projects add their own
3. Keep as-is (skips jobs if no package.json/requirements.txt)

**Recommendation:** Option 1 - preset-specific workflows

**Fix Location:**  
- `tools/cli/bpsai_pair/data/cookiecutter-paircoder/` - Add preset-specific workflow variants
- Or dynamically generate based on preset during init

**Acceptance Criteria:**
- [ ] React preset gets Node-only CI
- [ ] Python presets get Python-only CI
- [ ] Fullstack preset keeps both

---

### MISSING-004: docs/ vs .paircoder/ documentation structure
**Severity:** Medium  
**Component:** Cookie Cutter / Documentation Structure

**Description:**  
The cookie cutter puts `USER_GUIDE.md` in `docs/` at project root. This mixes PairCoder usage documentation with project-specific documentation, causing confusion about what ships with the tool vs what the user creates.

**Current (confusing):**
```
docs/
├── USER_GUIDE.md          # PairCoder usage guide (should ship with tool)
└── architecture.md        # Project-specific (user-created)
```

**Proposed (clear separation):**
```
.paircoder/
├── docs/                  # PairCoder usage documentation (ships with cookie cutter)
│   ├── USER_GUIDE.md      # How to use PairCoder
│   ├── MCP_SETUP.md       # MCP server configuration
│   └── FEATURE_MATRIX.md  # PairCoder capabilities reference
├── context/               # Project management context (for PairCoder to consume)
│   ├── project.md         # Project overview and constraints
│   ├── workflow.md        # Project-specific workflow rules
│   ├── state.md           # Current plan/task status
│   └── [openapi.json]     # API schemas, roadmaps, etc. (user adds as needed)
docs/                      # Project-specific documentation (user-created)
├── architecture.md
├── api.md
└── deployment.md
```

**Rationale:**
- `docs/` is for project-specific documentation created by the developer (architecture, API docs, deployment guides)
- `.paircoder/docs/` contains PairCoder usage guides that ship with the cookie cutter template - documentation FOR users of PairCoder
- `.paircoder/context/` contains documents that PairCoder uses to manage the project - documentation FOR PairCoder to consume
- Clear separation ensures:
  - Cookie cutter ships the right files to the right places
  - Users know where to put their own docs vs PairCoder's docs
  - PairCoder context files are clearly separated from reference documentation

**Fix Location:**  
`tools/cli/bpsai_pair/data/cookiecutter-paircoder/{{cookiecutter.project_slug}}/`

**Acceptance Criteria:**
- [ ] Create `.paircoder/docs/` directory in cookie cutter template
- [ ] Move USER_GUIDE.md to `.paircoder/docs/`
- [ ] Add workflow.md to `.paircoder/context/`
- [ ] Add MCP_SETUP.md to `.paircoder/docs/` (if applicable)
- [ ] Add FEATURE_MATRIX.md to `.paircoder/docs/` (or link to it)
- [ ] `docs/` directory created empty with `.gitkeep`
- [ ] CLAUDE.md updated to reference `.paircoder/context/` where necessary
- [ ] capabilities.yaml updated with new paths
- [ ] Existing projects migration guide documented in CHANGELOG

**Migration for Existing Projects:**
```bash
# Users with existing PairCoder projects should run:
mkdir -p .paircoder/docs
mv docs/USER_GUIDE.md .paircoder/docs/ 2>/dev/null || true
# Keep docs/ for project-specific documentation
```

## Enhancements

### ENH-001: Trello board initialization from template
**Priority:** Medium  
**Component:** Trello Integration

**Description:**  
Mike maintains a "BPS AI Project Template" board with all Butler rules, custom fields, labels pre-configured. New projects should be able to create a board from this template automatically.

**Proposed Command:**
```bash
bpsai-pair trello init-board --from-template "BPS AI Project Template" --name "My New Project"
```

**Implementation:**
1. Find template board by name
2. Use Trello API to copy board
3. Set new board_id in config.yaml
4. Butler rules, custom fields, labels all preserved

**Acceptance Criteria:**
- [ ] `trello init-board` command exists
- [ ] `--from-template` flag accepts board name
- [ ] `--name` flag sets new board name
- [ ] Board ID automatically saved to config
- [ ] All Butler rules copied
- [ ] All custom fields copied
- [ ] All labels copied

---

### ENH-002: Sprint completion checklist enforcement
**Priority:** Medium  
**Component:** Planning / CLI

**Description:**  
Cookie cutter and documentation updates are consistently forgotten at sprint end. Add enforcement.

**Proposed Flow:**
```bash
bpsai-pair sprint complete sprint-17

Pre-completion checklist:
  [ ] Cookie cutter template updated?
  [ ] CHANGELOG.md updated?
  [ ] Documentation updated?

Proceed? [y/N]
```

**Or auto-generate release tasks:**
```bash
bpsai-pair release plan --since v2.5.4

Generated tasks:
  - TASK-REL-001: Sync cookie cutter template
  - TASK-REL-002: Update CHANGELOG.md
  - TASK-REL-003: Bump version
```

**Acceptance Criteria:**
- [ ] Sprint complete command requires checklist acknowledgment
- [ ] OR release plan command generates sync tasks
- [ ] Documentation clearly states post-sprint requirements

---

### ENH-003: Preset validation and update command
**Priority:** Low  
**Component:** CLI

**Description:**  
After updating PairCoder, existing projects may have outdated config. Add command to validate and update config against current preset standards.

**Proposed Command:**
```bash
bpsai-pair config validate
# Shows: Missing sections: trello, estimation, security

bpsai-pair config update --preset react
# Adds missing sections while preserving existing values
```

**Acceptance Criteria:**
- [ ] `config validate` shows missing/outdated sections
- [ ] `config update` adds missing sections from preset
- [ ] Existing values preserved during update

---

## Documentation Gaps

### DOC-001: Slash commands not documented
**Severity:** Low  

**Description:**  
The `.claude/commands/` feature isn't documented in CLAUDE.md or USER_GUIDE.md.

**Fix:**
- Add section to CLAUDE.md explaining slash commands
- Add example commands to cookie cutter
- Document in USER_GUIDE.md

---

### DOC-002: Trello setup not in quick start
**Severity:** Medium

**Description:**  
Trello connection steps not clearly documented in README or quick start guide.

**Fix:**
- Add Trello setup section to README
- Include in `bpsai-pair init` output
- Add to USER_GUIDE.md

---

### DOC-003: Clarify `task update` vs `ttask` workflow for Trello projects
**Severity:** Medium

**Description:**  
Skills documentation is ambiguous about when to use `task update` vs `ttask` commands for Trello-integrated projects. Claude is using `task update` when `ttask` commands would be more appropriate.

**Current confusion:**
- `task update T2.3 --status done` - Updates local file, triggers hooks
- `ttask done <card-id>` - Checks acceptance criteria, moves card
- Skills say "use both" but order and when to use which is unclear

**Observed behavior:**
- Claude uses `task update` which updates local but doesn't properly sync Trello
- Two-step process is confusing and error-prone

**Proposed clarification:**

For Trello-integrated projects, prefer `ttask` commands:
```bash
# Start work
bpsai-pair ttask start <card-id>

# Complete work
bpsai-pair ttask done <card-id> -s "Summary of work"
```

`task update` should be reserved for:
- Non-Trello projects
- Bulk updates
- Status changes that don't need Trello sync

**Fix Location:**
- `.claude/skills/paircoder-task-lifecycle/SKILL.md`
- `.claude/skills/trello-task-workflow/SKILL.md`
- `docs/USER_GUIDE.md`

**Acceptance Criteria:**
- [ ] Skills clearly state which command to use for Trello projects
- [ ] Decision tree: "If Trello → use ttask, else → use task update"
- [ ] Examples updated to show ttask as primary for Trello projects

---

### DOC-004: BPS Trello board conventions not documented
**Severity:** High

**Description:**  
Skills don't document BPS-specific Trello board conventions. Claude moves dashboard/header cards and doesn't fill required custom fields.

**Issues observed:**
1. Claude moves "Info" list cards (Weekly Completed, Frontend Completed, etc.)
2. Custom fields not populated (Project, Stack, Repo URL)
3. Acceptance criteria checklist not checked off consistently
4. PR URLs not added to cards

**Required documentation:**

```markdown
## BPS Board Conventions

### Protected Cards (NEVER MOVE)
Cards in the "Info" list are dashboard cards:
- Weekly Completed, Frontend Completed, Backend Completed
- Aging WIP, Worker/Function Completed
- Board Setup card
- Any card with colored counter backgrounds

### Required Custom Fields
When creating/completing cards, set:
- Project: The project name (e.g., "Support App")
- Stack: Technology stack (React, Python, etc.)
- Repo URL: GitHub repository URL
- Effort: Task size (XS, S, M, L, XL)
- Agent Task: Check if AI-assignable

### On Task Completion
1. Check ALL acceptance criteria items in checklist
2. Verify custom fields are set
3. Add completion summary as comment

### On PR Creation
Add PR URL to card's "PR URL" custom field
```

**Fix Location:**
- `.claude/skills/trello-task-workflow/SKILL.md`
- `.claude/skills/trello-aware-planning/SKILL.md`
- New: `.paircoder/context/bps-board-conventions.md` (reference doc)

**Acceptance Criteria:**
- [ ] Info list cards documented as protected
- [ ] Custom field requirements documented
- [ ] Acceptance criteria checking emphasized
- [ ] PR URL workflow documented
- [ ] Reference doc created for board conventions

---

### ENH-004: CLI commands for Trello custom fields
**Severity:** Medium

**Description:**  
Need CLI commands to set Trello custom fields programmatically, or enhance existing commands to apply project defaults.

**Current state:**
- `ttask done` marks card complete but doesn't set custom fields
- No command to set Project, Stack, Repo URL fields
- Manual entry required for each card

**Proposed commands:**
```bash
# Set custom field on a card
bpsai-pair trello set-field <card-id> --project "Support App"
bpsai-pair trello set-field <card-id> --stack "React"
bpsai-pair trello set-field <card-id> --repo-url "https://github.com/..."

# Or batch set from config
bpsai-pair trello apply-defaults <card-id>
# Reads project name, repo URL from .paircoder/config.yaml

# Auto-apply on sync
bpsai-pair plan sync-trello <plan-id> --apply-defaults
```

**Config addition example:**
```yaml
trello:
  board_id: "..."
  defaults:
    project: "Support App"
    stack: "React"
    repo_url: "https://github.com/BPSAI/bpsai-support_react"
```

**Acceptance Criteria:**
- [ ] Can set custom fields via CLI
- [ ] Can apply project defaults to cards
- [ ] `plan sync-trello` optionally applies defaults
- [ ] `ttask start` optionally applies defaults

---

## Summary

| ID | Type | Severity | Component | Summary |
|----|------|----------|-----------|---------|
| REVIEW-001 | Review | **HIGH** | Cookie Cutter | Full template audit - files are stale |
| BUG-001 | Bug | Medium | CLI | Plan list shows 0 tasks |
| BUG-002 | Bug | Low | Cookie Cutter | project_tree.yml wrong path |
| BUG-003 | Bug | Medium | Planning/Hooks | Task missing `depends_on` breaks hook |
| MISSING-001 | Missing | Medium | Cookie Cutter | /commands directory |
| MISSING-002 | Missing | High | Presets | Trello/estimation/hooks config |
| MISSING-003 | Missing | Low | Cookie Cutter | Preset-specific CI workflows |
| MISSING-004 | Missing | Medium | Cookie Cutter | docs/ vs .paircoder/docs/ confusion |
| ENH-001 | Enhancement | Medium | Trello | Init board from template |
| ENH-002 | Enhancement | Medium | Planning | Sprint completion checklist |
| ENH-003 | Enhancement | Low | CLI | Config validate/update command |
| ENH-004 | Enhancement | Medium | Trello | CLI commands for custom fields |
| DOC-001 | Docs | Low | Docs | Slash commands documentation |
| DOC-002 | Docs | Medium | Docs | Trello setup in quick start |
| DOC-003 | Docs | Medium | Docs | Clarify task update vs ttask workflow |
| DOC-004 | Docs | **High** | Docs | BPS board conventions not documented |

---

## Next Steps

1. **PRIORITY:** REVIEW-001 - Full cookie cutter audit (blocks all new project inits)
2. Create tasks from this backlog in PairCoder project
3. Fix MISSING-002 (presets) as it affects all new projects
4. Schedule ENH-001 (Trello template) based on Mike's input
5. BUG-001 is a quick fix - do in next sprint
