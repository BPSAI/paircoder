# PairCoder v2 Upgrade Plan
# This plan follows the v2 schema we're implementing

id: plan-2025-01-paircoder-v2-upgrade
title: "PairCoder v2 Complete Upgrade"
type: feature
owner: buschleague
created_at: 2025-12-15T00:00:00Z
status: planned

flows:
  - design-plan-implement

goals:
  - Consolidate all PairCoder system files under .paircoder/ directory
  - Implement planning system (Goals → Tasks → Sprints)
  - Create LLM capability manifest for Claude Code integration
  - Correct ADR 0002 to include planning system
  - Separate package development from reference implementation
  - Enable LLMs to discover and use PairCoder without user CLI knowledge

acceptance_criteria:
  phase_1:
    - Claude Code can read .paircoder/ and understand available capabilities
    - Claude Code can create/update plans and tasks
    - Claude Code can run flows without user knowing CLI commands
    - This repo is fully migrated to v2 structure
  phase_2:
    - All core flows implemented (design-plan-implement, tdd-implement, review, finish-branch)
    - CLI extended with plan/task/models commands
    - cookiecutter template updated for end users
  phase_3:
    - Documentation updated
    - Release v2.0.0

# ============================================================================
# SPRINT 1: Foundation & Claude Code Integration
# Priority: Get Claude Code working with the system ASAP
# ============================================================================

sprints:
  - id: sprint-1
    title: "Foundation & Claude Code Integration"
    goal: "Enable Claude Code to work with PairCoder"
    tasks:
      - TASK-001
      - TASK-002
      - TASK-003
      - TASK-004
      - TASK-005
      - TASK-006

  - id: sprint-2
    title: "Planning System Implementation"
    goal: "Full planning workflow operational"
    tasks:
      - TASK-007
      - TASK-008
      - TASK-009
      - TASK-010

  - id: sprint-3
    title: "CLI Extensions & Flows"
    goal: "Complete CLI and core flows"
    tasks:
      - TASK-011
      - TASK-012
      - TASK-013
      - TASK-014
      - TASK-015

  - id: sprint-4
    title: "Template & Documentation"
    goal: "Ship to users"
    tasks:
      - TASK-016
      - TASK-017
      - TASK-018
      - TASK-019

# ============================================================================
# TASK DEFINITIONS
# ============================================================================

tasks:
  # --- Sprint 1: Foundation ---
  
  - id: TASK-001
    title: "Create v2 directory structure in this repo"
    type: refactor
    priority: P0
    complexity: 30
    sprint: sprint-1
    description: |
      Migrate this repo from current structure to v2 .paircoder/ layout.
      - Create .paircoder/context/ with project.md, workflow.md, state.md
      - Move flows to .paircoder/flows/
      - Create .paircoder/plans/ and .paircoder/tasks/
      - Update root AGENTS.md and CLAUDE.md as pointers
    verification:
      - ".paircoder/config.yaml exists"
      - ".paircoder/context/project.md exists"
      - "Root AGENTS.md points to .paircoder/"
    files_touched:
      - ".paircoder/*"
      - "AGENTS.md"
      - "CLAUDE.md"
      - "context/* (delete after migration)"

  - id: TASK-002
    title: "Create LLM capability manifest"
    type: feature
    priority: P0
    complexity: 40
    sprint: sprint-1
    description: |
      Create .paircoder/capabilities.yaml that tells LLMs:
      - What commands/functions are available
      - When to use each one
      - How to invoke them (CLI or programmatic)
      - What context files to read first
      This is the key to Claude Code integration.
    verification:
      - "capabilities.yaml is valid YAML"
      - "All CLI commands documented"
      - "Trigger conditions specified"
    outputs:
      - ".paircoder/capabilities.yaml"

  - id: TASK-003
    title: "Update ADR 0002 - Add planning system"
    type: docs
    priority: P0
    complexity: 20
    sprint: sprint-1
    description: |
      Correct ADR 0002 to:
      - Remove "Planning OS" from exclusions
      - Add planning system (Goals → Tasks → Sprints) to included features
      - Document plan/task YAML schemas
      - Add capability manifest to architecture
    verification:
      - "ADR 0002 no longer excludes planning"
      - "Plan and task schemas documented"
    files_touched:
      - "docs/adr/0002-paircoder-v2.md"

  - id: TASK-004
    title: "Create project.md for this repo"
    type: docs
    priority: P0
    complexity: 15
    sprint: sprint-1
    description: |
      Write .paircoder/context/project.md with:
      - Project purpose (PairCoder CLI tool)
      - Key constraints (cross-platform, Python 3.9+)
      - Architecture overview
      - What LLMs need to know to work here
    verification:
      - "project.md exists and is comprehensive"
    outputs:
      - ".paircoder/context/project.md"

  - id: TASK-005
    title: "Create workflow.md for this repo"
    type: docs
    priority: P0
    complexity: 15
    sprint: sprint-1
    description: |
      Write .paircoder/context/workflow.md with:
      - Branch conventions
      - Testing requirements
      - Review process
      - How to use PairCoder on PairCoder
    verification:
      - "workflow.md exists"
    outputs:
      - ".paircoder/context/workflow.md"

  - id: TASK-006
    title: "Create state.md with current upgrade status"
    type: docs
    priority: P0
    complexity: 10
    sprint: sprint-1
    description: |
      Create .paircoder/context/state.md that tracks:
      - Current active plan
      - Task statuses
      - Blockers
      This replaces the "Context Sync" block approach.
    verification:
      - "state.md exists"
      - "Current plan referenced"
    outputs:
      - ".paircoder/context/state.md"

  # --- Sprint 2: Planning System ---

  - id: TASK-007
    title: "Implement plan YAML parser"
    type: feature
    priority: P0
    complexity: 40
    sprint: sprint-2
    description: |
      Add plan parsing to bpsai_pair/flows/:
      - Plan schema validation
      - Load/save plans
      - Task reference resolution
    verification:
      - "Unit tests pass"
      - "Can parse example plan"
    files_touched:
      - "tools/cli/bpsai_pair/planning/__init__.py"
      - "tools/cli/bpsai_pair/planning/models.py"
      - "tools/cli/bpsai_pair/planning/parser.py"

  - id: TASK-008
    title: "Implement task YAML+MD parser"
    type: feature
    priority: P0
    complexity: 35
    sprint: sprint-2
    description: |
      Add task parsing with YAML frontmatter + Markdown body:
      - Parse .task.md files
      - Extract metadata and body
      - Link to parent plan
    verification:
      - "Unit tests pass"
      - "Can parse example task"
    files_touched:
      - "tools/cli/bpsai_pair/planning/tasks.py"

  - id: TASK-009
    title: "Add 'bpsai-pair plan' CLI commands"
    type: feature
    priority: P1
    complexity: 50
    sprint: sprint-2
    description: |
      Implement CLI subcommands:
      - plan new <slug> --type <type>
      - plan list
      - plan show <id>
      - plan tasks <id>
    verification:
      - "CLI --help shows plan commands"
      - "Commands execute without error"
    files_touched:
      - "tools/cli/bpsai_pair/cli.py"

  - id: TASK-010
    title: "Add 'bpsai-pair task' CLI commands"
    type: feature
    priority: P1
    complexity: 40
    sprint: sprint-2
    description: |
      Implement CLI subcommands:
      - task list [--plan <id>]
      - task show <id>
      - task update <id> --status <status>
    verification:
      - "CLI --help shows task commands"
      - "Commands execute without error"
    files_touched:
      - "tools/cli/bpsai_pair/cli.py"

  # --- Sprint 3: CLI Extensions & Flows ---

  - id: TASK-011
    title: "Create design-plan-implement.flow.md"
    type: feature
    priority: P1
    complexity: 35
    sprint: sprint-3
    description: |
      Create the core planning flow with:
      - YAML frontmatter (triggers, roles, requirements)
      - Markdown body with phases
      - Subflow references
    verification:
      - "Flow validates"
      - "bpsai-pair flow show works"
    outputs:
      - ".paircoder/flows/design-plan-implement.flow.md"

  - id: TASK-012
    title: "Create tdd-implement.flow.md"
    type: feature
    priority: P1
    complexity: 30
    sprint: sprint-3
    description: |
      TDD implementation flow:
      - Red-green-refactor cycle
      - Test-first approach
      - Verification gates
    outputs:
      - ".paircoder/flows/tdd-implement.flow.md"

  - id: TASK-013
    title: "Create review.flow.md"
    type: feature
    priority: P1
    complexity: 25
    sprint: sprint-3
    description: |
      Code review flow:
      - Static analysis checks
      - Diff explanation
      - Approval gates
    outputs:
      - ".paircoder/flows/review.flow.md"

  - id: TASK-014
    title: "Create finish-branch.flow.md"
    type: feature
    priority: P2
    complexity: 20
    sprint: sprint-3
    description: |
      Branch completion flow:
      - Final verification
      - Merge preparation
      - Cleanup
    outputs:
      - ".paircoder/flows/finish-branch.flow.md"

  - id: TASK-015
    title: "Update flow parser for .flow.md format"
    type: refactor
    priority: P1
    complexity: 40
    sprint: sprint-3
    description: |
      Extend current flow parser to handle:
      - YAML frontmatter + Markdown body
      - .flow.md extension
      - Subflow references
    verification:
      - "Existing tests still pass"
      - "New format tests pass"
    files_touched:
      - "tools/cli/bpsai_pair/flows/parser.py"
      - "tools/cli/bpsai_pair/flows/models.py"

  # --- Sprint 4: Template & Documentation ---

  - id: TASK-016
    title: "Update cookiecutter template for v2"
    type: refactor
    priority: P1
    complexity: 50
    sprint: sprint-4
    description: |
      Update tools/cli/bpsai_pair/data/cookiecutter-paircoder/ to:
      - Use .paircoder/ structure
      - Include default flows
      - Include capabilities.yaml
      - Remove old context/ structure
    verification:
      - "bpsai-pair-init produces v2 structure"
      - "Smoke tests pass"
    files_touched:
      - "tools/cli/bpsai_pair/data/cookiecutter-paircoder/**"

  - id: TASK-017
    title: "Update USER_GUIDE.md for v2"
    type: docs
    priority: P2
    complexity: 30
    sprint: sprint-4
    description: |
      Rewrite documentation for v2:
      - New directory structure
      - Planning workflow
      - Flow usage
      - LLM integration
    files_touched:
      - "tools/cli/USER_GUIDE.md"
      - "paircoder-docs.md"

  - id: TASK-018
    title: "Update README.md for v2"
    type: docs
    priority: P2
    complexity: 20
    sprint: sprint-4
    description: |
      Update main README with:
      - v2 features overview
      - New commands
      - Migration notes (brief)
    files_touched:
      - "README.md"
      - "tools/cli/README.md"

  - id: TASK-019
    title: "Bump version and prepare release"
    type: chore
    priority: P2
    complexity: 15
    sprint: sprint-4
    description: |
      - Update version to 0.3.0 (or 2.0.0)
      - Update CHANGELOG.md
      - Tag release
    verification:
      - "Version bumped in pyproject.toml"
      - "CHANGELOG updated"
    files_touched:
      - "tools/cli/pyproject.toml"
      - "CHANGELOG.md"
