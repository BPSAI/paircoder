---
id: T29.1
title: Design Sandbox Config Schema
status: done
priority: P0
complexity: 25
plan: plan-2026-01-sprint-29-contained-autonomy
---

# Objective

Define the complete sandbox configuration schema that will control contained autonomy behavior. This is the foundation for all sandbox functionality.

# Files to Update

| File | Change |
|------|--------|
| `tools/cli/bpsai_pair/core/config.py` | Add `SandboxConfig` Pydantic model |

# Implementation Plan

1. Create `SandboxConfig` Pydantic model with fields:
   - `enabled: bool = False`
   - `locked_directories: list[str]`
   - `locked_files: list[str]`
   - `allow_network: list[str]` (with defaults)
   - `auto_checkpoint: bool = True`
   - `rollback_on_violation: bool = False`

2. Add path validation for `locked_directories` and `locked_files`

3. Add domain validation for `allow_network`

4. Define sensible defaults for network allowlist:
   - api.anthropic.com
   - api.trello.com
   - github.com
   - pypi.org

5. Document all fields with docstrings

# Acceptance Criteria

- [ ] `SandboxConfig` Pydantic model created
- [ ] Validation for `locked_directories` paths works
- [ ] Validation for `locked_files` paths works
- [ ] Validation for `allow_network` domains works
- [ ] Default values documented
- [ ] Schema added to config.py (not yet wired to ConfigModel - that's T29.2)

# Verification

```bash
# Unit tests for SandboxConfig validation
pytest tests/core/test_config.py -k sandbox -v

# Test valid config loads
python -c "from bpsai_pair.core.config import SandboxConfig; print(SandboxConfig())"
```

# Implementation Notes

```python
# tools/cli/bpsai_pair/core/config.py

class SandboxConfig(BaseModel):
    """Configuration for contained autonomy sandbox."""
    enabled: bool = Field(default=False, description="Enable sandbox mode")
    locked_directories: list[str] = Field(
        default_factory=list,
        description="Directories mounted read-only in sandbox mode"
    )
    locked_files: list[str] = Field(
        default_factory=list,
        description="Files mounted read-only in sandbox mode"
    )
    allow_network: list[str] = Field(
        default_factory=lambda: [
            "api.anthropic.com",
            "api.trello.com",
            "github.com",
            "pypi.org"
        ],
        description="Network domains allowed in sandbox mode"
    )
    auto_checkpoint: bool = Field(
        default=True,
        description="Create git checkpoint on sandbox entry"
    )
    rollback_on_violation: bool = Field(
        default=False,
        description="Rollback on sandbox violation attempts"
    )
```

# Test Cases

- Valid config loads successfully
- Invalid directory paths rejected
- Empty network list uses defaults
- Nested path validation works