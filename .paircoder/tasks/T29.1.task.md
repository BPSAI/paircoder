---
id: T29.1
title: Design Containment Config Schema
status: done
priority: P0
complexity: 25
plan: plan-2026-01-sprint-29-contained-autonomy
---

# Objective

Define the complete containment configuration schema that will control contained autonomy behavior. This is the foundation for all containment functionality.

# Files to Update

| File | Change                             |
|------|------------------------------------|
| `tools/cli/bpsai_pair/core/config.py` | Add `ContainmentConfig` Dataclass model |

# Implementation Plan

1. Create `ContainmentConfig` Dataclass model with fields:
   - `enabled: bool = False`
   - `locked_directories: list[str]`
   - `locked_files: list[str]`
   - `allow_network: list[str]` (with defaults)
   - `auto_checkpoint: bool = True`
   - `rollback_on_violation: bool = False`

2. Add path validation for `locked_directories` and `locked_files`

3. Add domain validation for `allow_network`

4. Define sensible defaults for network allowlist:
   - api.anthropic.com
   - api.trello.com
   - github.com
   - pypi.org

5. Document all fields with docstrings

# Acceptance Criteria

- [x] `ContainmentConfig` dataclass created
- [x] Validation for `locked_directories` paths works
- [x] Validation for `locked_files` paths works
- [x] Validation for `allow_network` domains works
- [x] Default values documented
- [x] Schema added to config.py (not yet wired to ConfigModel - that's T29.2)

# Verification

```bash
# Unit tests for ContainmentConfig validation
pytest tests/core/test_containment_config.py -v

# Test valid config loads
python -c "from bpsai_pair.core.config import ContainmentConfig; print(ContainmentConfig())"
```

# Implementation Notes

```python
# tools/cli/bpsai_pair/core/config.py

class ContainmentConfig:
    """Configuration for contained autonomy mode."""
    enabled: bool = False
    locked_directories: list[str] = field(default_factory=list)
    locked_files: list[str] = field(default_factory=list)
    allow_network: list[str] = field(default_factory=lambda: DEFAULT_CONTAINMENT_NETWORK_ALLOWLIST.copy())
    auto_checkpoint: bool = True
    rollback_on_violation: bool = False
```

# Test Cases

- Valid config loads successfully
- Invalid directory paths rejected
- Empty network list uses defaults
- Nested path validation works
