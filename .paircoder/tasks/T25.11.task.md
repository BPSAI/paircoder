---
id: T25.11
title: Add pre-task budget hook
type: feature
status: done
priority: P2
complexity: 20
plan: plan-2025-12-sprint-25-epic003-token-budget
effort: S
---

# T25.11: Add pre-task budget hook

## Objective

Add a hook that warns users before starting tasks that may exceed token budget.

## Implementation

Add to `on_task_start` hook in config.yaml:
```yaml
hooks:
  on_task_start:
    - check_token_budget    # NEW - warns if task large
    - start_timer
    - sync_trello
    - update_state
```

Warning output:
```
⚠️ TOKEN BUDGET WARNING
Task T25.8 estimated at 75,000 tokens (75% of budget)
Consider breaking into smaller subtasks.
Continue anyway? [y/N]:
```

## Acceptance Criteria

- [ ] `check_token_budget` hook function exists
- [ ] Warns when task exceeds warning threshold (default 75%)
- [ ] User can continue or abort
- [ ] Hook registered in config.yaml template
- [ ] Warning includes token breakdown summary
- [ ] `--force` flag bypasses warning
- [ ] Tests cover hook behavior

## Files to Modify

- `bpsai_pair/core/hooks.py` - Add `check_token_budget` function
- `.paircoder/config.yaml` - Add hook to on_task_start
- Cookiecutter template config.yaml
- `tests/test_hooks.py` - Add tests

## Dependencies

- T25.8: Create tokens.py estimation module
- T25.9: Add budget CLI commands

## Notes

The hook should be non-blocking by default in CI environments (check for TTY). Only prompt when running interactively.