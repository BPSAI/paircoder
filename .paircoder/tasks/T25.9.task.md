---
id: T25.9
title: Add budget CLI commands
type: feature
status: done
priority: P1
complexity: 35
plan: plan-2025-12-sprint-25-epic003-token-budget
effort: M
---

# T25.9: Add budget CLI commands

## Objective

Create CLI commands for token budget estimation and checking.

## Implementation

Create `tools/cli/bpsai_pair/commands/budget.py`:

```bash
# Estimate tokens for a task
bpsai-pair budget estimate T25.8
# Output:
#   Task: T25.8 - Create tokens.py estimation module
#   Files: 3 (tokens.py, test_tokens.py, commands/budget.py)
#
#   Token Breakdown:
#     Base context:    15,000
#     Task file:          450
#     Source files:     3,200
#     Est. output:      5,000
#     ─────────────────────────
#     Total:           23,650 (24% of budget)
#
#   Status: ✅ OK

# Estimate for specific files
bpsai-pair budget estimate -f src/main.py -f src/utils.py

# Show current session budget status
bpsai-pair budget status

# Pre-flight check (exits 1 if over threshold)
bpsai-pair budget check T25.8 --threshold 75
```

## Acceptance Criteria

- [ ] `bpsai-pair budget estimate <task>` shows token breakdown
- [ ] `bpsai-pair budget estimate -f <file>` estimates specific files
- [ ] `bpsai-pair budget status` shows session usage
- [ ] `bpsai-pair budget check` exits 1 if over threshold
- [ ] Output is formatted clearly with Rich tables
- [ ] Supports `--json` flag for machine-readable output
- [ ] Tests cover all commands

## Files to Create

- `bpsai_pair/commands/budget.py`
- Update `bpsai_pair/commands/__init__.py`
- Update `bpsai_pair/cli.py` to register budget_app
- `tests/test_budget_commands.py`

## Dependencies

- T25.8: Create tokens.py estimation module

## Notes

Exit codes for `budget check`:
- 0: Under threshold
- 1: Over threshold
- 2: Task not found or error