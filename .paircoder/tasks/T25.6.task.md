---
id: T25.6
title: Fix project root detection in all commands
type: bugfix
status: done
priority: P0
complexity: 20
plan: plan-2025-12-sprint-25-epic003-token-budget
effort: S
---

# T25.6: Fix project root detection in all commands

## Objective

Fix the bug where commands use `Path.cwd()` instead of finding the actual project root, causing `.paircoder/` directories to be created in wrong locations.

## Problem

Commands use `Path.cwd()` instead of finding actual project root. This causes `.paircoder/` directories to be created in wrong locations when running from subdirectories.

**Evidence:** Stray `.paircoder/` found at `tools/cli/.paircoder/`

## Solution

Add helper to `core/ops.py`:
```python
def find_project_root(start_path: Path = None) -> Path:
    """Find project root by walking up to find .paircoder/ or .git/"""
    cwd = start_path or Path.cwd()
    for parent in [cwd, *cwd.parents]:
        if (parent / ".paircoder").exists():
            return parent
        if (parent / ".git").exists():
            return parent
    return cwd
```

## Acceptance Criteria

- [ ] `find_project_root()` exists in core/ops.py
- [ ] `upgrade` command uses `find_project_root()`
- [ ] `trello connect` uses `find_project_root()`
- [ ] Test: running command from subdirectory finds correct root
- [ ] No stray `.paircoder/` directories
- [ ] Delete `tools/cli/.paircoder/` if it exists

## Files to Modify

- `bpsai_pair/core/ops.py` - Add `find_project_root()` function
- `bpsai_pair/commands/upgrade.py` (line ~318)
- `bpsai_pair/trello/commands.py` (trello connect)
- Any other command using `Path.cwd()` for project paths

## Dependencies

None - can be done independently.

## Notes

Immediate cleanup:
```bash
rm -rf tools/cli/.paircoder
```

Search for uses of `Path.cwd()`:
```bash
grep -rn "Path.cwd()" bpsai_pair/ --include="*.py"
```