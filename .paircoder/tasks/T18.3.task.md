---
id: T18.3
title: Cookie Cutter Drift Detection CLI
plan: plan-2025-12-sprint-18-release-engineering
type: feature
priority: P1
complexity: 40
status: done
depends_on: []
tags:
- cli
- template
- automation
---

# Objective

Add ongoing drift detection between source files and cookie cutter template as a CLI command and CI check. Builds on Sprint 17.5's one-time audit (TASK-150).

# Proposed CLI

```bash
bpsai-pair template check

Cookie Cutter Template Status:
  ✅ config.yaml - Up to date
  ✅ state.md - Up to date
  ⚠️  CLAUDE.md - Minor drift (3 lines changed)
  ✅ ci.yml - Up to date

All critical files in sync.
```

# CI Integration

Add workflow:

```yaml
# .github/workflows/template-check.yml
name: Template Drift Check

on: [push, pull_request]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install CLI
        run: pip install -e tools/cli
      - name: Check template drift
        run: bpsai-pair template check --fail-on-drift
```

# Implementation

Compare key files between:
- **Source:** Current repo files (e.g., `.paircoder/config.yaml`)
- **Template:** `tools/cli/bpsai_pair/data/cookiecutter-paircoder/{{cookiecutter.project_slug}}/.paircoder/`

## Files to Check

1. `.paircoder/config.yaml`
2. `.paircoder/context/state.md`
3. `.paircoder/context/project.md`
4. `CLAUDE.md`
5. `.github/workflows/ci.yml`

# Acceptance Criteria

- [x] `bpsai-pair template check` command exists
- [x] Compares template files to source equivalents
- [x] Reports drift with actionable messages showing line diff count
- [x] CI workflow file created for automated checking
- [x] `--fail-on-drift` flag for CI enforcement (exit code 1 if drift)
- [x] `--fix` flag to auto-sync template from source (no confirmation prompt for simplicity)
- [x] Clear output with status icons (✅ ⚠️ ❌)

# Files to Create/Modify

- `tools/cli/bpsai_pair/commands/template.py` (new)
- `tools/cli/bpsai_pair/cli.py` (register command)
- `.github/workflows/template-check.yml` (new)
- `tests/commands/test_template.py` (new)

# Dependencies

None - can start in parallel with T18.2.