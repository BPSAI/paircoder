---
id: T19.9
title: Detect Manual Task File Edits
plan: plan-2025-12-sprint-19-methodology
type: feature
priority: P1
complexity: 30
status: done
depends_on:
- T19.1
tags:
- workflow
- hooks
- detection
---

# Objective

Detect when task file status is changed by direct file edit (not CLI). Manual edits bypass hooks, causing Trello desync, missed timers, and broken velocity tracking.

# Root Cause (Sprint 18 Incident)

Claude manually edited task files:
```yaml
status: in_progress  →  status: done  # Manual edit - NO hooks fired
```

Result: Trello cards not moved, timers not stopped, velocity not recorded.

# Implementation

## Option A: CLI Warning on Next Run (Recommended)

```bash
$ bpsai-pair task list

⚠️ Warning: T18.2 status changed outside CLI (hooks may not have fired)
   File modified: 2025-12-22 10:30
   Last CLI update: 2025-12-22 09:15

   To sync: bpsai-pair task update T18.2 --status done --resync
```

Track last CLI update timestamp per task.

## Option B: Git Pre-commit Hook (Optional)

```bash
# .git/hooks/pre-commit
# Warn if .task.md files have status changes
```

# Acceptance Criteria

- [ ] Detects status changes made outside CLI
- [ ] Shows warning on next CLI command
- [ ] Provides `--resync` flag to re-trigger hooks
- [ ] Tracks last CLI update timestamp per task
- [ ] Optional: git pre-commit hook for prevention
- [ ] Unit tests for detection logic

# Files to Modify

- `src/bpsai_pair/planning/task_commands.py`
- `.paircoder/cache/` - Track CLI timestamps
- `tests/test_task_commands.py`
- `.git/hooks/pre-commit` - Optional

# Dependencies

T19.1 (both enforce proper workflow)