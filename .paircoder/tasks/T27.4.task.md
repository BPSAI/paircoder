---
id: T27.4
title: Fix upgrade source file resolution
plan: plan-2025-12-sprint-27-stabilization
type: bugfix
priority: P0
complexity: 55
status: done
sprint: 27
tags:
- stabilization
- bugfix
- upgrade
depends_on: []
---

# Objective

Fix `bpsai-pair upgrade` which can't find source files to copy because it looks in the wrong location.

# Implementation Plan

1. Run upgrade and capture the error
2. Find the upgrade command implementation
3. Check how it resolves paths (dev mode vs pip-installed)
4. Implement robust package data resolution using importlib.resources
5. Ensure pyproject.toml includes data files in package_data
6. Test in both dev mode and installed mode

# Acceptance Criteria

- [ ] `bpsai-pair upgrade` finds source files when pip-installed
- [ ] `bpsai-pair upgrade` finds source files in dev mode
- [ ] Clear error message if files not found
- [ ] Works on all platforms (Windows, Mac, Linux)

# Verification

```bash
# Test in dev mode
bpsai-pair upgrade --dry-run  # If flag exists

# Test installed mode
pip install -e tools/cli/
bpsai-pair upgrade --dry-run

# Run upgrade tests
pytest tests/commands/test_upgrade.py -v
```