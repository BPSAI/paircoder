# CLI Architecture: Before & After

## Current State (33,878 lines)

```
┌─────────────────────────────────────────────────────────────────┐
│                          cli.py (2,892 lines)                   │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│  │ preset  │ │ config  │ │orchestr.│ │ metrics │ │  timer  │   │
│  │ commands│ │ commands│ │ commands│ │ commands│ │ commands│   │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘   │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│  │benchmark│ │  cache  │ │   mcp   │ │  flow   │ │security │   │
│  │ commands│ │ commands│ │ commands│ │ commands│ │ commands│   │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │               init, feature, pack, status, ...            │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│              planning/cli_commands.py (2,602 lines)             │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│  │  plan   │ │  task   │ │ intent  │ │ standup │ │ sprint  │   │
│  │ commands│ │ commands│ │ commands│ │ commands│ │ commands│   │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘   │
│  ┌─────────────────────┐ ┌─────────────────────────────────┐   │
│  │   release commands  │ │       template commands         │   │
│  │   (doesn't belong)  │ │       (doesn't belong)          │   │
│  └─────────────────────┘ └─────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘

Root Level Sprawl:
┌────────────┬────────────┬────────────┬────────────┐
│ config.py  │ hooks.py   │ presets.py │   ops.py   │
│   (575)    │   (621)    │   (560)    │   (525)    │
├────────────┼────────────┼────────────┼────────────┤
│constants.py│  utils.py  │ pyutils.py │ jsonio.py  │
│   (69)     │   (11)     │   (25)     │   (5)      │
└────────────┴────────────┴────────────┴────────────┘
```

## Proposed State

```
┌───────────────────────────────────────┐
│         cli.py (~150 lines)           │
│   ┌─────────────────────────────┐     │
│   │   Sub-app registration only  │     │
│   │   No command implementations │     │
│   └─────────────────────────────┘     │
└───────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        commands/ (NEW)                          │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│  │core.py  │ │preset.py│ │config.py│ │metrics.py│ │timer.py │   │
│  │  (400)  │ │  (150)  │ │  (200)  │ │  (350)  │ │  (150)  │   │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘   │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌──────────┐  │
│  │bench.py │ │cache.py │ │ mcp.py  │ │orch.py  │ │security.py│  │
│  │  (200)  │ │  (100)  │ │  (150)  │ │  (300)  │ │  (250)   │  │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └──────────┘  │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                          core/ (NEW)                            │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│  │config.py│ │hooks.py │ │presets.py│ │  ops.py │ │ utils.py│   │
│  │  (575)  │ │  (621)  │ │  (560)  │ │  (525)  │ │  (41)   │   │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘   │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────┐  ┌──────────────────────┐  ┌──────────────┐
│     planning/        │  │      sprint/ (NEW)   │  │release/ (NEW)│
│  ┌────────────────┐  │  │  ┌────────────────┐  │  │┌────────────┐│
│  │  commands.py   │  │  │  │  commands.py   │  │  ││commands.py ││
│  │ plan + task    │  │  │  │  list/complete │  │  ││plan/prep   ││
│  │    (~600)      │  │  │  │    (~200)      │  │  ││  (~300)    ││
│  └────────────────┘  │  │  └────────────────┘  │  │├────────────┤│
│  ┌────────────────┐  │  └──────────────────────┘  ││template.py ││
│  │ intent, standup│  │                            ││  (~200)    ││
│  └────────────────┘  │                            │└────────────┘│
└──────────────────────┘                            └──────────────┘

Domain Modules (Unchanged):
┌────────────┬────────────┬────────────┬────────────┐
│  trello/   │  github/   │  metrics/  │orchestr./  │
│  (4,506)   │  (1,387)   │  (2,207)   │  (5,410)   │
├────────────┼────────────┼────────────┼────────────┤
│ security/  │   mcp/     │ benchmarks/│  context/  │
│  (2,948)   │  (1,095)   │   (801)    │   (254)    │
└────────────┴────────────┴────────────┴────────────┘
```

## Key Metrics

| Metric | Before | After | Improvement |
|--------|--------|-------|-------------|
| cli.py | 2,892 | ~150 | -95% |
| planning/cli_commands.py | 2,602 | ~600 | -77% |
| Largest file | 2,892 | ~621 | -79% |
| Root-level .py files | 12 | 3 | -75% |
| Misplaced commands | 3 groups | 0 | -100% |

## Import Flow (Post-Refactor)

```
                    cli.py
                       │
        ┌──────────────┼──────────────┐
        │              │              │
        ▼              ▼              ▼
   commands/      planning/      release/
        │              │              │
        └──────────────┼──────────────┘
                       │
                       ▼
                    core/
                       │
            ┌──────────┴──────────┐
            │                     │
            ▼                     ▼
    Domain modules          External libs
    (trello, github,       (typer, rich,
     metrics, etc.)         pyyaml, etc.)
```

## Sprint Roadmap

```
Sprint 22 ─────────────────────────────────────────────►
  Extract commands from cli.py → commands/
  
Sprint 23 ─────────────────────────────────────────────►
  Extract sprint/release/template from planning/
  
Sprint 24 ─────────────────────────────────────────────►
  Create core/, consolidate root files, merge parsers
  
Sprint 25 ─────────────────────────────────────────────►
  Documentation, cleanup, final review
```
